language: generic
dist: xenial
before_install:
  - pyenv global 3.6.7
  - phpenv global 7.3
install:
  - pip install --user awscli
  - pip install --user aws-sam-cli
script:
  - composer install --no-interaction --optimize-autoloader --prefer-dist
  - composer test
after_success:
  - wget https://scrutinizer-ci.com/ocular.phar
  - php ocular.phar code-coverage:upload --format=php-clover ./clover.xml
before_deploy:
  - composer update --no-dev
  - composer package
deploy:
  provider: script
  script: composer deploy
  skip_cleanup: true
  on:
    repo: guillermoandrae/php-lambda-skeleton
